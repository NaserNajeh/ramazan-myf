<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>برنامج رمضان</title>

  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#0b5d4a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="برنامج رمضان">

  <style>
    :root {
      --bg1: #041513;
      --bg2: #0b5d4a;
      --glass: rgba(255, 255, 255, .10);
      --glass2: rgba(255, 255, 255, .16);
      --stroke: rgba(255, 255, 255, .18);
      --text: rgba(255, 255, 255, .92);
      --muted: rgba(255, 255, 255, .72);
      --gold: #d8b35a;
      --mint: #1fbf9a;
      --shadow: 0 22px 60px rgba(0, 0, 0, .35);
      --radius: 18px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 15% 10%, rgba(216, 179, 90, .28), transparent 58%),
        radial-gradient(900px 700px at 90% 20%, rgba(31, 191, 154, .22), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--text);
      overflow-x: hidden;
    }

    /* توهج وأشعة متحركة */
    .glow-layer {
      position: fixed;
      inset: -30vh -30vw;
      pointer-events: none;
      filter: blur(24px);
      opacity: .75;
      z-index: 0;
    }

    .glow-layer::before,
    .glow-layer::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(closest-side at 20% 25%, rgba(216, 179, 90, .35), transparent 65%),
        radial-gradient(closest-side at 80% 20%, rgba(31, 191, 154, .28), transparent 60%),
        radial-gradient(closest-side at 55% 80%, rgba(255, 255, 255, .10), transparent 70%);
      transform: translate3d(0, 0, 0);
    }

    .glow-layer::after {
      background:
        radial-gradient(closest-side at 30% 70%, rgba(31, 191, 154, .22), transparent 62%),
        radial-gradient(closest-side at 75% 60%, rgba(216, 179, 90, .24), transparent 62%);
      opacity: .8;
      mix-blend-mode: screen;
    }

    .beams {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .55;
      z-index: 1;
      mix-blend-mode: screen;
    }

    .beam {
      position: absolute;
      width: 55vw;
      height: 140vh;
      top: -20vh;
      left: -10vw;
      background: linear-gradient(180deg,
          rgba(216, 179, 90, 0) 0%,
          rgba(216, 179, 90, .10) 30%,
          rgba(31, 191, 154, .10) 55%,
          rgba(216, 179, 90, 0) 100%);
      transform: rotate(18deg);
      filter: blur(10px);
    }

    .beam.b2 {
      left: 35vw;
      width: 45vw;
      transform: rotate(-12deg);
      opacity: .45;
      background: linear-gradient(180deg,
          rgba(31, 191, 154, 0) 0%,
          rgba(31, 191, 154, .14) 38%,
          rgba(216, 179, 90, .10) 58%,
          rgba(31, 191, 154, 0) 100%);
    }

    /* زخرفة إسلامية */
    .ornament-bg {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .16;
      z-index: 1;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><defs><pattern id="p" width="64" height="64" patternUnits="userSpaceOnUse"><path d="M32 6 L46 20 L58 32 L46 44 L32 58 L18 44 L6 32 L18 20 Z" fill="none" stroke="%23d8b35a" stroke-width="1.2"/><circle cx="32" cy="32" r="6" fill="none" stroke="%23ffffff" stroke-opacity=".35" stroke-width="1"/><path d="M32 14 C42 14 50 22 50 32 C50 42 42 50 32 50 C22 50 14 42 14 32 C14 22 22 14 32 14 Z" fill="none" stroke="%231fbf9a" stroke-opacity=".55" stroke-width="1"/></pattern></defs><rect width="200" height="200" fill="url(%23p)"/></svg>');
    }

    header {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 14px 12px 12px;
      /* removed backdrop-filter: blur(14px); */
      background: linear-gradient(135deg, rgba(11, 93, 74, 0.95), rgba(4, 21, 19, 0.98));
      border-bottom: 1px solid rgba(255, 255, 255, .12);
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 0 10px;
      position: relative;
      z-index: 2;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand h1 {
      margin: 0;
      font-size: 15px;
      line-height: 1.2;
    }

    .brand .sub {
      margin-top: 2px;
      font-size: 11px;
      color: var(--muted);
    }

    .chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      background: rgba(255, 255, 255, .10);
      border: 1px solid rgba(255, 255, 255, .16);
      color: #fff;
      white-space: nowrap;
      box-shadow: 0 10px 22px rgba(0, 0, 0, .14);
    }

    .chip.gold {
      background: rgba(216, 179, 90, .14);
      border-color: rgba(216, 179, 90, .25);
    }

    .chip.mint {
      background: rgba(31, 191, 154, .12);
      border-color: rgba(31, 191, 154, .22);
    }

    .icon {
      width: 36px;
      height: 36px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      background: rgba(216, 179, 90, .14);
      border: 1px solid rgba(216, 179, 90, .24);
      box-shadow: 0 12px 26px rgba(0, 0, 0, .18);
      overflow: hidden;
    }

    .icon img {
      width: 28px;
      height: 28px;
      border-radius: 10px;
    }

    main {
      padding: 14px 0 28px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    @media (min-width: 860px) {
      .grid {
        grid-template-columns: 1.1fr .9fr;
        align-items: start;
      }
    }

    .card {
      background: rgba(11, 93, 74, 0.4);
      border: 1px solid rgba(255, 255, 255, .18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      /* removed backdrop-filter: blur(16px); */
    }

    .cardHead {
      padding: 12px 12px 10px;
      background: linear-gradient(135deg, rgba(216, 179, 90, .12), rgba(31, 191, 154, .10));
      border-bottom: 1px solid rgba(255, 255, 255, .14);
    }

    .cardHead h2 {
      margin: 0;
      font-size: 14px;
    }

    .cardBody {
      padding: 12px;
    }

    .navRow {
      display: grid;
      grid-template-columns: 1fr 1.4fr 1fr;
      gap: 10px;
      align-items: center;
    }

    .btn {
      border: 1px solid rgba(255, 255, 255, .18);
      background: linear-gradient(135deg, rgba(255, 255, 255, .14), rgba(255, 255, 255, .08));
      padding: 11px 12px;
      border-radius: 14px;
      font-weight: 1000;
      cursor: pointer;
      color: #fff;
      box-shadow: 0 10px 22px rgba(0, 0, 0, .18);
      transition: transform .08s ease, filter .15s ease;
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, .25), transparent 55%);
      transform: translateX(-30%);
      opacity: .0;
      transition: opacity .2s ease;
    }

    .btn:hover::after {
      opacity: .55;
    }

    .btn:active {
      transform: scale(.99);
    }

    .btn.primary {
      background: linear-gradient(135deg, rgba(31, 191, 154, .18), rgba(11, 93, 74, .18));
      border-color: rgba(31, 191, 154, .26);
    }

    .btn.danger {
      background: linear-gradient(135deg, rgba(255, 107, 107, .18), rgba(216, 179, 90, .08));
      border-color: rgba(255, 107, 107, .26);
    }

    .btn:disabled {
      opacity: .45;
      cursor: not-allowed;
    }

    .centerInfo {
      padding: 10px 10px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .18);
      background: linear-gradient(135deg, rgba(255, 255, 255, .12), rgba(255, 255, 255, .06));
      text-align: center;
      backdrop-filter: blur(12px);
    }

    .centerInfo .d1 {
      font-weight: 1100;
      font-size: 14px;
    }

    .centerInfo .d2 {
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }

    .badges {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 1000;
      border: 1px solid rgba(255, 255, 255, .18);
      background: rgba(255, 255, 255, .10);
      color: #fff;
    }

    .badge.ok {
      background: rgba(31, 191, 154, .12);
      border-color: rgba(31, 191, 154, .24);
    }

    .badge.warn {
      background: rgba(216, 179, 90, .14);
      border-color: rgba(216, 179, 90, .28);
    }

    .badge.miss {
      background: rgba(0, 0, 0, .12);
      border-color: rgba(255, 255, 255, .16);
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .16);
      background: linear-gradient(135deg, rgba(255, 255, 255, .12), rgba(255, 255, 255, .06));
      backdrop-filter: blur(12px);
    }

    .item .meta {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .item label {
      font-size: 13px;
      font-weight: 1050;
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
    }

    input[type="checkbox"] {
      width: 22px;
      height: 22px;
      accent-color: var(--mint);
    }

    .scaleBox {
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .16);
      background: linear-gradient(135deg, rgba(255, 255, 255, .12), rgba(255, 255, 255, .06));
      backdrop-filter: blur(12px);
    }

    .scaleTop {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .pill {
      padding: 7px 10px;
      border-radius: 999px;
      font-weight: 1050;
      font-size: 12px;
      background: rgba(255, 255, 255, .10);
      border: 1px solid rgba(255, 255, 255, .16);
    }

    .toggleSwitch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggleSwitch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, .1);
      transition: .4s;
      border-radius: 34px;
      border: 1px solid rgba(255, 255, 255, .2);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 3px;
      bottom: 3px;
      background-color: #bbb;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: var(--gold);
      border-color: var(--gold);
    }

    input:checked+.slider:before {
      transform: translateX(20px);
      background-color: #fff;
    }

    input[type="range"] {
      width: 100%;
      margin-top: 10px;
    }

    textarea {
      width: 100%;
      min-height: 80px;
      resize: vertical;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .16);
      padding: 12px;
      font-size: 13px;
      background: rgba(0, 0, 0, .10);
      color: #fff;
      outline: none;
      backdrop-filter: blur(10px);
    }

    textarea::placeholder {
      color: rgba(255, 255, 255, .65);
    }

    textarea:focus {
      border-color: rgba(31, 191, 154, .45);
      box-shadow: 0 0 0 4px rgba(31, 191, 154, .12);
    }

    details summary {
      cursor: pointer;
      list-style: none;
      user-select: none;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .16);
      background: linear-gradient(135deg, rgba(255, 255, 255, .12), rgba(255, 255, 255, .06));
      font-weight: 1050;
    }

    details summary::-webkit-details-marker {
      display: none;
    }

    details .inside {
      padding: 10px 4px 0;
    }

    .tableWrap {
      overflow: auto;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, .16);
      background: rgba(0, 0, 0, .10);
      backdrop-filter: blur(10px);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 980px;
      color: #fff;
    }

    th,
    td {
      border: 1px solid rgba(255, 255, 255, .10);
      padding: 8px;
      font-size: 12px;
      text-align: center;
    }

    th {
      background: linear-gradient(135deg, rgba(216, 179, 90, .18), rgba(31, 191, 154, .12));
      position: sticky;
      top: 0;
      z-index: 5;
      font-weight: 1100;
    }

    tr:hover td {
      background: rgba(31, 191, 154, .06);
    }

    .footerNote {
      text-align: center;
      color: rgba(255, 255, 255, .72);
      font-size: 11px;
      margin-top: 12px;
    }

    .installBar {
      position: fixed;
      left: 10px;
      right: 10px;
      bottom: 10px;
      z-index: 9999;
      display: none;
      gap: 10px;
      align-items: center;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, .18);
      background: linear-gradient(135deg, rgba(255, 255, 255, .14), rgba(255, 255, 255, .08));
      backdrop-filter: blur(16px);
      box-shadow: 0 22px 60px rgba(0, 0, 0, .35);
    }

    .installBar .txt {
      flex: 1;
      min-width: 160px;
    }

    .installBar .t1 {
      font-weight: 1100;
      font-size: 13px;
    }

    .installBar .t2 {
      margin-top: 2px;
      font-size: 11px;
      color: var(--muted);
    }

    .installBar .actions {
      display: flex;
      gap: 8px;
    }

    .installBar .miniBtn {
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, .18);
      background: rgba(0, 0, 0, .12);
      color: #fff;
      font-weight: 1050;
      cursor: pointer;
    }

    .installBar .miniBtn.ok {
      background: linear-gradient(135deg, rgba(31, 191, 154, .22), rgba(11, 93, 74, .22));
      border-color: rgba(31, 191, 154, .28);
    }
  </style>
</head>

<body>
  <div class="glow-layer"></div>
  <div class="beams">
    <div class="beam"></div>
    <div class="beam b2"></div>
  </div>
  <div class="ornament-bg"></div>

  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <img
            src="https://github.com/NaserNajeh/ramazan-myf/blob/main/374946672_289987087105699_6304014763515905168_n.jpg?raw=true"
            alt="شعار ملتقى الشباب المسلم"
            style="width:46px; height:46px; border-radius:50%; border:2px solid var(--gold); box-shadow: 0 0 12px rgba(216,179,90,.30); object-fit:cover;">
          <div>
            <h1>برنامج رمضان</h1>
            <div class="sub">ملتقى الشباب المسلم • فلسطين</div>
          </div>
        </div>
        <div class="chips">
          <span class="chip gold" id="ramadanChip">1 رمضان</span>
          <span class="chip" id="gregChip">الأربعاء 18/2/2026</span>
          <span class="chip mint" id="scoreChip">0%</span>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="grid">
        <section class="card">
          <div class="cardHead">
            <h2>بنود اليوم</h2>
          </div>
          <div class="cardBody">
            <div class="navRow">
              <button class="btn" id="prevDay">اليوم السابق</button>
              <div class="centerInfo">
                <div class="d1" id="dayTitle">اليوم 1 رمضان</div>
                <div class="d2" id="dayDate">الأربعاء 18/2/2026</div>
                <div class="badges">
                  <span class="badge miss" id="statusBadge">غير مكتمل</span>
                  <span class="badge" id="boolBadge">0 / 9</span>

                </div>
              </div>
              <button class="btn" id="nextDay">اليوم التالي</button>
            </div>

            <div style="height:8px"></div>

            <div class="scaleBox">
              <div class="scaleTop">
                <div style="display:flex; flex-direction:column; gap:3px;">
                  <div style="font-weight:1100;">ختم القرآن (عدد الأجزاء) <span
                      style='color:var(--gold); font-size:12px;'>— ختم القرآن مرة على الأقل</span></div>
                  <div class="hint">العدّاد ثابت طوال الشهر — كل رقم يمثل جزءًا (حتى 30).</div>
                </div>
                <span class="pill" id="quranCountDisplay">0 / 30</span>
                <span class="badge ok" id="khatmaBadge" style="margin-right:6px; font-size:13px;">🏆 0 ختمات</span>
              </div>
              <div style="display:flex; gap:8px; margin-top:10px;">
                <button class="btn primary" id="quranPlus">+ جزء</button>
                <button class="btn" id="quranMinus">- جزء</button>
                <button class="btn danger" id="quranReset">تصفير</button>
              </div>
            </div>
            <div style="height:8px"></div>

            <div class="list" id="itemsList"></div>

            <div style="height:8px"></div>
            <div class="scaleBox">
              <div style="font-weight:1100; margin-bottom:6px;">عمل خاص</div>
              <div class="hint" style="margin-bottom:10px;">ملاحظة قصيرة لليوم (لا تدخل ضمن نسبة الإنجاز).</div>
              <textarea id="note" maxlength="140" placeholder="اكتب عملك الخاص هنا…"></textarea>
            </div>

            <div style="height:8px"></div>

            <!-- صدقة الفطر - منفصلة -->
            <div class="scaleBox" style="border-color:var(--text); background:rgba(0,0,0,.2);">
              <div style="display:flex; align-items:center; justify-content:space-between;">
                <div style="display:flex; align-items:center; gap:8px;">
                  <span style="font-size:18px;">💰</span>
                  <div style="font-weight:1100;">صدقة الفطر</div>
                </div>
                <label class="toggleSwitch">
                  <input type="checkbox" id="fitrCheck">
                  <span class="slider"></span>
                </label>
              </div>
              <div class="hint" style="margin-top:6px;">تُخرج مرة واحدة في نهاية الشهر (لا تدخل في النسبة اليومية).
              </div>
            </div>

            <div style="height:8px"></div>
            <div class="navRow" style="grid-template-columns: 1fr 1fr 1fr;">
              <button class="btn primary" id="markAll">تأشير كل البنود</button>
              <button class="btn" id="clearDay">مسح اليوم</button>
              <button class="btn danger" id="resetAll">إعادة ضبط الشهر</button>
            </div>
          </div>
        </section>


        <section class="card">
          <div class="cardHead">
            <h2>متابعة الشهر</h2>
          </div>
          <div class="cardBody">
            <details open>
              <summary>إحصاءات سريعة</summary>
              <div class="inside" id="statsBox"></div>
            </details>
            <div style="height:6px"></div>
            <details>
              <summary>جدول الشهر (30 يوم)</summary>
              <div class="inside">
                <div class="tableWrap">
                  <table id="monthTable"></table>
                </div>
                <div class="hint" style="margin-top:8px;">مرّر أفقيًا لمشاهدة كل الأعمدة.</div>
              </div>
            </details>
          </div>
        </section>
      </div>


      <!-- فاصل مميز قبل قسم طلاب القرآن -->
      <div style="margin-top:16px; margin-bottom:6px; display:flex; align-items:center; gap:12px;">
        <div
          style="flex:1; height:1px; background:linear-gradient(90deg, transparent, rgba(216,179,90,.5), transparent);">
        </div>
        <div
          style="font-size:14px; font-weight:900; color:var(--gold); letter-spacing:.5px; white-space:nowrap; text-shadow:0 0 14px rgba(216,179,90,.5);">
          ✦ خاص بطلبة القرآن الكريم ✦</div>
        <div
          style="flex:1; height:1px; background:linear-gradient(90deg, transparent, rgba(216,179,90,.5), transparent);">
        </div>
      </div>

      <!-- قسم طلاب القرآن - في أسفل الصفحة -->
      <section class="card" style="margin-top:8px; border-color:rgba(216,179,90,.3);">
        <div class="cardHead" style="background: linear-gradient(135deg, rgba(216,179,90,.18), rgba(31,191,154,.10));">
          <h2 style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
            <span style="font-size:20px;">📖</span>
            <span style="color:var(--gold); font-weight:900;">طالب القرآن الكريم</span>
            <span
              style="font-size:11px; font-weight:500; color:var(--muted); background:rgba(0,0,0,.2); padding:3px 8px; border-radius:999px; border:1px solid rgba(255,255,255,.12);">لا
              تدخل في نسبة الإنجاز</span>
          </h2>
        </div>
        <div class="cardBody">
          <div style="font-size:13px; color:var(--muted); margin-bottom:12px;">عدد الصفحات المقروءة بتجويد اليوم</div>
          <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
            <div style="display:flex; align-items:center; gap:10px;">
              <button class="btn" id="pagesMinusBtn"
                style="min-width:44px; font-size:18px; padding:8px 14px;">−</button>
              <div style="text-align:center; min-width:80px;">
                <div id="pagesDisplay" style="font-size:36px; font-weight:900; color:var(--gold); line-height:1;">0
                </div>
                <div style="font-size:11px; color:var(--muted); margin-top:2px;">صفحة</div>
              </div>
              <button class="btn primary" id="pagesPlusBtn"
                style="min-width:44px; font-size:18px; padding:8px 14px;">+</button>
            </div>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
              <button class="btn" id="pagesResetBtn" style="font-size:12px; padding:7px 12px;">تصفير اليوم</button>
              <div id="pagesTotalDisplay"
                style="font-size:12px; color:var(--muted); padding:6px 12px; background:rgba(216,179,90,.08); border-radius:10px; border:1px solid rgba(216,179,90,.2);">
                مجموع الشهر: <strong id="pagesMonthTotal" style="color:var(--gold); font-size:14px;">0</strong> صفحة
              </div>
            </div>
          </div>
        </div>
      </section>
      <div class="footerNote">مع تحيات - ملتقى الشباب المسلم - فلسطين • على iPhone: زر المشاركة → “إضافة إلى الشاشة
        الرئيسية”. على Android: ⋮ → “تثبيت التطبيق”.</div>
    </div>
  </main>

  <div class="installBar" id="installBar">
    <div class="txt">
      <div class="t1">ثبّت التطبيق على الشاشة الرئيسية</div>
      <div class="t2">يفتح كتطبيق مستقل ويعمل دون إنترنت.</div>
    </div>
    <div class="actions">
      <button class="miniBtn" id="installLater">لاحقًا</button>
      <button class="miniBtn ok" id="installNow">تثبيت</button>
    </div>
  </div>

  <script>
    // PWA: Service Worker
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        try { await navigator.serviceWorker.register("./sw.js"); } catch (e) { }
      });
    }

    // Install prompt (Android Chrome)
    let deferredPrompt = null;
    const installBar = document.getElementById("installBar");
    const installNow = document.getElementById("installNow");
    const installLater = document.getElementById("installLater");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBar.style.display = "flex";
    });

    installLater.addEventListener("click", () => { installBar.style.display = "none"; });
    installNow.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      try { await deferredPrompt.userChoice; } catch (e) { }
      deferredPrompt = null;
      installBar.style.display = "none";
    });

    // Dates
    const PRESET_DATES = ["2026-02-18", "2026-02-19", "2026-02-20", "2026-02-21", "2026-02-22", "2026-02-23", "2026-02-24", "2026-02-25", "2026-02-26", "2026-02-27", "2026-02-28", "2026-03-01", "2026-03-02", "2026-03-03", "2026-03-04", "2026-03-05", "2026-03-06", "2026-03-07", "2026-03-08", "2026-03-09", "2026-03-10", "2026-03-11", "2026-03-12", "2026-03-13", "2026-03-14", "2026-03-15", "2026-03-16", "2026-03-17", "2026-03-18", "2026-03-19"];

    function formatArabicWeekday(d) {
      return new Intl.DateTimeFormat('ar', { weekday: 'long' }).format(d);
    }
    function formatArabicDate(d) {
      const day = d.getDate();
      const month = d.getMonth() + 1;
      const year = d.getFullYear();
      return `${day}/${month}/${year}`;
    }

    const TEMPLATE = {
      days: 30,
      habits: [
        { key: "fast_guard", label: "حفظ الصوم من معاصي الجوارح اليوم" },
        { key: "dalail_khayrat", label: "دلائل الخيرات/حزب اليوم" },
        { key: "taraweeh", label: "التراويح" },
        { key: "tahajjud_2", label: "ركعتين تهجد قبل الفجر" },
        { key: "duha_2", label: "صلاة الضحى ٢-٤ ركعات" },
        { key: "awwabin", label: "صلاة الأوابين، ٢-٤-٦ ركعات، بعد سنة المغرب" },
        { key: "wird_sabah", label: "ورد الصباح" },
        { key: "wird_masaa", label: "ورد المساء" },
        { key: "wird_masaa", label: "ورد المساء" }
      ]
    };


    const QURAN_COUNTER_KEY = "ramadan_quran_counter_v1";
    const KHATMA_COUNTER_KEY = "ramadan_khatma_counter_v1";
    function loadQuranCounter() {
      return Number(localStorage.getItem(QURAN_COUNTER_KEY) || 0);
    }
    function saveQuranCounter(val) {
      localStorage.setItem(QURAN_COUNTER_KEY, val);
    }
    function loadKhatmaCounter() {
      return Number(localStorage.getItem(KHATMA_COUNTER_KEY) || 0);
    }
    function saveKhatmaCounter(val) {
      localStorage.setItem(KHATMA_COUNTER_KEY, val);
    }

    const STORAGE_KEY = "ramadan_pwa_state_v1";
    const UI_KEY = "ramadan_pwa_ui_v1";

    function emptyDay() {
      const day = { note: "" };
      TEMPLATE.habits.forEach(h => day[h.key] = false);
      return day;
    }

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) {
        const init = {};
        for (let d = 1; d <= TEMPLATE.days; d++) init[d] = emptyDay();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(init));
        return init;
      }
      try {
        const st = JSON.parse(raw);
        for (let d = 1; d <= TEMPLATE.days; d++) if (!st[d]) st[d] = emptyDay();
        return st;
      } catch (e) {
        const init = {};
        for (let d = 1; d <= TEMPLATE.days; d++) init[d] = emptyDay();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(init));
        return init;
      }
    }
    function saveState(st) { localStorage.setItem(STORAGE_KEY, JSON.stringify(st)); }

    function loadUI() {
      const raw = localStorage.getItem(UI_KEY);
      if (!raw) return { currentDay: 1 };
      try { return JSON.parse(raw); } catch (e) { return { currentDay: 1 }; }
    }
    function saveUI(ui) { localStorage.setItem(UI_KEY, JSON.stringify(ui)); }

    function calcDayScore(dayData) {
      const totalBool = TEMPLATE.habits.length;
      const doneBool = TEMPLATE.habits.reduce((a, h) => a + (dayData[h.key] ? 1 : 0), 0); const totalUnits = totalBool;
      const doneUnits = doneBool;
      const pct = Math.round((doneUnits / totalUnits) * 100); const complete = (doneBool === totalBool); const partial = (doneBool > 0);
      return { pct, complete, partial, doneBool, totalBool };
    }

    const state = loadState();
    const ui = loadUI();

    const el = {
      prevDay: document.getElementById("prevDay"),
      nextDay: document.getElementById("nextDay"),
      itemsList: document.getElementById("itemsList"), note: document.getElementById("note"),
      markAll: document.getElementById("markAll"),
      clearDay: document.getElementById("clearDay"),
      resetAll: document.getElementById("resetAll"),
      statusBadge: document.getElementById("statusBadge"),
      boolBadge: document.getElementById("boolBadge"), ramadanChip: document.getElementById("ramadanChip"),
      gregChip: document.getElementById("gregChip"),
      scoreChip: document.getElementById("scoreChip"),
      dayTitle: document.getElementById("dayTitle"),
      dayDate: document.getElementById("dayDate"),
      statsBox: document.getElementById("statsBox"),
      monthTable: document.getElementById("monthTable")
    };

    function clampDay(n) { return Math.max(1, Math.min(TEMPLATE.days, n)); }

    function getDayDate(dayNum) {
      const iso = PRESET_DATES[dayNum - 1];
      const d = new Date(iso + "T00:00:00");
      const weekday = formatArabicWeekday(d);
      const dmy = formatArabicDate(d);
      return { iso, d, weekday, dmy };
    }

    function setStatus(score) {
      el.statusBadge.className = "badge";
      if (score.complete) { el.statusBadge.textContent = "مكتمل"; el.statusBadge.classList.add("ok"); }
      else if (score.partial) { el.statusBadge.textContent = "جزئي"; el.statusBadge.classList.add("warn"); }
      else { el.statusBadge.textContent = "غير مكتمل"; el.statusBadge.classList.add("miss"); }
    }

    function renderDay() {
      ui.currentDay = clampDay(ui.currentDay || 1);
      saveUI(ui);

      const dayNum = ui.currentDay;
      const dayData = state[dayNum];
      const score = calcDayScore(dayData);
      const dd = getDayDate(dayNum);

      el.ramadanChip.textContent = `${dayNum} رمضان`;
      el.gregChip.textContent = `${dd.weekday} ${dd.dmy}`;
      el.scoreChip.textContent = `${score.pct}%`;

      el.dayTitle.textContent = `اليوم ${dayNum} رمضان`;
      el.dayDate.textContent = `${dd.weekday} • ${dd.dmy}`;

      setStatus(score);
      el.boolBadge.textContent = `${score.doneBool} / ${score.totalBool}`;
      el.prevDay.disabled = dayNum <= 1;
      el.nextDay.disabled = dayNum >= TEMPLATE.days;

      el.itemsList.innerHTML = "";
      TEMPLATE.habits.forEach(h => {
        const wrap = document.createElement("div");
        wrap.className = "item";

        const meta = document.createElement("div");
        meta.className = "meta";
        const lab = document.createElement("label");
        lab.innerHTML = h.label;
        const hint = document.createElement("div");
        hint.className = "hint";
        hint.textContent = "تأشير عند الإتمام";
        meta.appendChild(lab);
        meta.appendChild(hint);

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!dayData[h.key];
        cb.addEventListener("change", () => {
          dayData[h.key] = cb.checked;
          saveState(state);
          renderDay();
          renderStats();
          renderMonthTable();
        });

        wrap.appendChild(meta);
        wrap.appendChild(cb);
        el.itemsList.appendChild(wrap);
      });
      el.note.value = dayData.note || "";
      el.note.oninput = () => {
        dayData.note = el.note.value;
        saveState(state);
        renderMonthTable();
      };
      // Update pages counter when day changes
      if (typeof renderPagesCounter === "function") renderPagesCounter();
    }

    function renderStats() {
      let completed = 0, partial = 0, zero = 0;
      let avg = 0;
      for (let d = 1; d <= TEMPLATE.days; d++) {
        const sc = calcDayScore(state[d]);
        avg += sc.pct;
        if (sc.complete) completed++;
        else if (sc.partial) partial++;
        else zero++;
      }
      avg = Math.round(avg / TEMPLATE.days);

      const per = TEMPLATE.habits.map(h => {
        let c = 0;
        for (let d = 1; d <= TEMPLATE.days; d++) if (state[d][h.key]) c++;
        return { label: h.label, count: c };
      }).sort((a, b) => b.count - a.count);

      el.statsBox.innerHTML = `
      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px;">
        <span class="badge ok">أيام مكتملة: ${completed}</span>
        <span class="badge warn">أيام جزئية: ${partial}</span>
        <span class="badge miss">أيام بلا إنجاز: ${zero}</span>
        <span class="badge">متوسط: ${avg}%</span>      </div>
      <div class="hint" style="margin-bottom:8px;">أكثر البنود التزامًا (عدد الأيام):</div>
      <div style="display:flex; flex-direction:column; gap:8px;">
        ${per.slice(0, 8).map(x => `
          <div class="item" style="padding:10px 12px;">
            <div class="meta">
              <label>${x.label}</label>
              <div class="hint">${x.count} / ${TEMPLATE.days}</div>
            </div>
            <span class="pill">${Math.round((x.count / TEMPLATE.days) * 100)}%</span>
          </div>
        `).join("")}
      </div>
    `;
    }

    function renderMonthTable() {
      let thead = "<thead><tr><th>اليوم</th><th>التاريخ</th>";
      TEMPLATE.habits.forEach(h => thead += `<th>${escapeHtml(h.label)}</th>`);
      thead += "<th>الإنجاز</th></tr></thead>";

      let tbody = "<tbody>";
      for (let d = 1; d <= TEMPLATE.days; d++) {
        const dd = getDayDate(d);
        const sc = calcDayScore(state[d]);
        const cls = sc.complete ? "ok" : (sc.partial ? "warn" : "miss");

        tbody += `<tr>
        <td><strong>${d} رمضان</strong></td>
        <td>${escapeHtml(dd.weekday)} ${escapeHtml(dd.dmy)}</td>
      `;
        TEMPLATE.habits.forEach(h => {
          tbody += `<td>${state[d][h.key] ? "✓" : ""}</td>`;
        }); tbody += `<td><span class="badge ${cls}">${sc.pct}%</span></td></tr>`;
      }
      tbody += "</tbody>";

      el.monthTable.innerHTML = thead + tbody;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    el.prevDay.addEventListener("click", () => { ui.currentDay = clampDay(ui.currentDay - 1); renderDay(); });
    el.nextDay.addEventListener("click", () => { ui.currentDay = clampDay(ui.currentDay + 1); renderDay(); });

    el.markAll.addEventListener("click", () => {
      const d = ui.currentDay;
      TEMPLATE.habits.forEach(h => state[d][h.key] = true);
      saveState(state);
      renderDay(); renderStats(); renderMonthTable();
    });

    el.clearDay.addEventListener("click", () => {
      const d = ui.currentDay;
      state[d] = emptyDay();
      saveState(state);
      renderDay(); renderStats(); renderMonthTable();
    });

    el.resetAll.addEventListener("click", () => {
      const ok = confirm("سيتم مسح كل بيانات الشهر على هذا الجهاز. هل تريد المتابعة؟");
      if (!ok) return;
      for (let d = 1; d <= TEMPLATE.days; d++) state[d] = emptyDay();
      saveState(state);
      ui.currentDay = 1;
      saveUI(ui);
      renderDay(); renderStats(); renderMonthTable();
    });

    // Quran Counter + Khatma Logic
    const quranDisplay = document.getElementById("quranCountDisplay");
    const quranPlus = document.getElementById("quranPlus");
    const quranMinus = document.getElementById("quranMinus");
    const quranReset = document.getElementById("quranReset");
    const khatmaBadge = document.getElementById("khatmaBadge");

    function renderQuranCounter() {
      const val = Math.max(0, Math.min(30, loadQuranCounter()));
      quranDisplay.textContent = val + " / 30";
      const khatma = loadKhatmaCounter();
      khatmaBadge.textContent = "🏆 " + khatma + (khatma === 1 ? " ختمة" : " ختمات");
    }

    quranPlus.onclick = () => {
      let val = loadQuranCounter();
      if (val < 30) {
        val += 1;
        saveQuranCounter(val);
        if (val === 30) {
          const k = loadKhatmaCounter() + 1;
          saveKhatmaCounter(k);
          saveQuranCounter(0);
        }
      }
      renderQuranCounter();
    };

    quranMinus.onclick = () => {
      let val = loadQuranCounter();
      if (val > 0) { val -= 1; saveQuranCounter(val); }
      renderQuranCounter();
    };

    quranReset.onclick = () => {
      saveQuranCounter(0);
      saveKhatmaCounter(0);
      renderQuranCounter();
    };

    // ========= عداد صفحات طالب القرآن =========
    const PAGES_KEY = "ramadan_quran_pages_v1"; // { day: count }

    function loadPagesData() {
      try { return JSON.parse(localStorage.getItem(PAGES_KEY) || "{}"); } catch (e) { return {}; }
    }
    function savePagesData(data) { localStorage.setItem(PAGES_KEY, JSON.stringify(data)); }

    function getPagesForDay(day) {
      return Number(loadPagesData()[day] || 0);
    }
    function setPagesForDay(day, val) {
      const data = loadPagesData();
      data[day] = Math.max(0, val);
      savePagesData(data);
    }

    function getMonthPagesTotal() {
      const data = loadPagesData();
      return Object.values(data).reduce((sum, v) => sum + Number(v || 0), 0);
    }

    function renderPagesCounter() {
      const day = loadUI().currentDay;
      const pages = getPagesForDay(day);
      document.getElementById("pagesDisplay").textContent = pages;
      document.getElementById("pagesMonthTotal").textContent = getMonthPagesTotal();
    }

    document.getElementById("pagesPlusBtn").onclick = () => {
      const day = loadUI().currentDay;
      setPagesForDay(day, getPagesForDay(day) + 1);
      renderPagesCounter();
    };

    document.getElementById("pagesMinusBtn").onclick = () => {
      const day = loadUI().currentDay;
      setPagesForDay(day, getPagesForDay(day) - 1);
      renderPagesCounter();
    };

    document.getElementById("pagesResetBtn").onclick = () => {
      const day = loadUI().currentDay;
      setPagesForDay(day, 0);
      renderPagesCounter();
    };

    renderPagesCounter();

    // ========= صدقة الفطر =========
    const FITR_KEY = "ramadan_fitr_sadaqah_v1";
    const fitrCheck = document.getElementById("fitrCheck");

    function loadFitr() {
      return localStorage.getItem(FITR_KEY) === "true";
    }
    function renderFitr() {
      fitrCheck.checked = loadFitr();
    }
    fitrCheck.addEventListener("change", () => {
      localStorage.setItem(FITR_KEY, fitrCheck.checked);
    });

    // ========= Initial Render =========
    renderDay();
    renderStats();
    renderMonthTable();
    renderQuranCounter();
    renderFitr();
  </script>
</body>

</html>